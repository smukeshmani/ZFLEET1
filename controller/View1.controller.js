sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/core/ValueState","sap/m/MessageToast","sap/ui/core/library"],function(e,t,o,s,i,r,a,l){"use strict";return e.extend("ZGBC_FLEET.ZGBC_FLEET.controller.View1",{onInit:function(){var e,t;t=this.getView();e=sap.ui.getCore().getMessageManager();t.setModel(e.getMessageModel(),"message");var o={VehicleType:[],VehicleTypeVisbile:false,VehicleSelected:null,MonthlyRent:[],MonthlyRentVisbible:false,MonthlyRentSelected:null,SumitRequestVisible:false};this.oLocalModel=new sap.ui.model.json.JSONModel(o);t.setModel(this.oLocalModel,"localModel");var s={Response:[],Text:"",Type:"",Visible:false};this.oLocalModel2=new sap.ui.model.json.JSONModel(s);t.setModel(this.oLocalModel2,"localModel2")},onSubmit:function(e){var t=e.getSource().getValue();var o=this;var s="/EmployeeDetailsSet('"+t+"')";var i=this.getView().getModel();i.read(s,{success:function(e,t){var r=new sap.ui.model.json.JSONModel(e);var a=o.getView().byId("IdEmpDetail");a.setModel(r);o.getView().getModel("localModel").setProperty("/VehicleTypeVisbile",true);o.getView().getModel("localModel").setProperty("/MonthlyRentVisbible",true);var l=o.getView().byId("idEmpSubGroup").getText();s="/VehicleDropdownSet";var d="EmpSubgroup eq '"+l+"'";i.read(s,{urlParameters:{$filter:d},success:function(e,t){o.oLocalModel.setProperty("/VehicleType",e.results);var r=o.getView().getModel("localModel").getProperty("/VehicleType/0/VehicleKey");l=o.getView().byId("idEmpSubGroup").getText();s="/InstallmentListSet";d="EmpSubGroup eq '"+l+"' and VehicleType eq '"+r+"'";i.read(s,{urlParameters:{$filter:d},success:function(e,t){o.oLocalModel.setProperty("/MonthlyRent",e.results);o.getView().getModel("localModel").setProperty("/SumitRequestVisible",true)},error:function(){sap.m.MessageToast.show("No Data retreived")}})},error:function(){sap.m.MessageToast.show("You are not eligible to create request")}})},error:function(){o.getView().getModel("localModel").setProperty("/VehicleTypeVisbile",false);o.getView().getModel("localModel").setProperty("/MonthlyRentVisbible",false);o.getView().getModel("localModel").setProperty("/SumitRequestVisible",false);sap.m.MessageToast.show("No Data retreived")}})},onSelectVehicle:function(e){var t=this.getView().getModel("localModel").getProperty("/VehicleSelected");var o=this.getView().byId("idEmpSubGroup").getText();var s=this.getView().getModel();var i="/InstallmentListSet";var r="EmpSubGroup eq '"+o+"' and VehicleType eq '"+t+"'";var a=this;s.read(i,{urlParameters:{$filter:r},success:function(e,t){a.oLocalModel.setProperty("/MonthlyRent",e.results);a.getView().getModel("localModel").setProperty("/SumitRequestVisible",true)},error:function(){sap.m.MessageToast.show("No Data retreived")}})},onSubmitRequest:function(e){var t="";var o=this.getView().byId("idEmpid").getValue();var s=this.getView().byId("idNameEn").getText();var i=this.getView().byId("idNameAr").getText();var a=this.getView().byId("idPositionCode").getText();var l=this.getView().byId("idPositionEn").getText();var d=this.getView().byId("idPositionAr").getText();var n=this.getView().byId("idDepartmentEn").getText();var g=this.getView().byId("idDepartmentAr").getText();var u=this.getView().byId("idCocd").getText();var c=this.getView().byId("idCompanyName").getText();var p=this.getView().byId("idEmpSubGroup").getText();var M=this.getView().byId("idEmpSubGroupDesc").getText();var V=this.getView().byId("idIquama").getText();var h=this.getView().byId("idDl").getValue();var y=this.getView().byId("idDl");if(h===""){y.setValueState(r.Error);y.setValueStateText("Driving Liesence Is Required");return}else{y.setValueState(r.None)}var m=this.getView().getModel("localModel").getProperty("/VehicleSelected");var v=this.getView().getModel("localModel").getProperty("/MonthlyRentSelected");var b=this.getView().getModel();var w=this;var T={Pernr:o,NameEn:s,NameAr:i,PositionId:a,PositionTextEn:l,PositionTextAr:d,NatioEn:"",NatioAr:"",DepartmentEn:n,DepartmentAr:g,IdNoEn:V,IdNoAr:"",Cocd:u,CocdDesc:c,Dl:h,EmpSubgroup:p,EmpSubgroupDesc:M,RequestHeaderToItemNav:[{VehicleType:m,InstallmentCat:v}]};b.create("/FleetRequestHeaderSet",T,{success:function(e,o){if(e.Requestduplicate==="X"){t="X";sap.m.MessageToast.show("Duplicate Request being submitted.")}if(e.Requesterror==="X"){t="X";sap.m.MessageToast.show("Error while submitting request. Please Try again.")}if(t!=="X"){w.oLocalModel2.setProperty("/Response",e);w.oLocalModel2.setProperty("/Type","Success");w.oLocalModel2.setProperty("/Visible",true);var s=w.oLocalModel2.getProperty("/Response/RequestId");var i="Service vehicle request :"+s+" has been generated successfully";sap.m.MessageToast.show(i);w.oLocalModel2.setProperty("/Text",i);w.getView().getModel("localModel").setProperty("/SumitRequestVisible",false)}},error:function(e){var t=jQuery.parseJSON(e.responseText).error.message.value;sap.m.MessageToast.show(t);return}})},onMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment(this.getView().getId(),"ZGBC_FLEET.ZGBC_FLEET.view.Fragment",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover}})});